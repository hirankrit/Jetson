# üì∑ IMX219 Stereo Camera Calibration Guide

## Asymmetric Circles Pattern (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏á‡∏≤‡∏ô‡πÄ‡∏Å‡∏©‡∏ï‡∏£)

### ‡∏ó‡∏≥‡πÑ‡∏°‡πÉ‡∏ä‡πâ Asymmetric Circles?

‚úÖ **‡∏Ç‡πâ‡∏≠‡∏î‡∏µ:**
- ‡∏ó‡∏ô‡∏ó‡∏≤‡∏ô‡∏ï‡πà‡∏≠‡πÅ‡∏™‡∏á‡πÑ‡∏°‡πà‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠ (‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö natural lighting)
- Sub-pixel accuracy ‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤ checkerboard
- Unique pattern ‚Üí ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏õ‡∏±‡∏ç‡∏´‡∏≤ ambiguity
- ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÄ‡∏•‡πá‡∏Å‡πÜ ‡πÄ‡∏ä‡πà‡∏ô ‡∏û‡∏£‡∏¥‡∏Å, ‡∏ú‡∏•‡πÑ‡∏°‡πâ

üìê **Pattern Specifications:**
```
Type: Asymmetric Circles Grid
Rows: 5
Columns: 13
Diagonal Spacing: 18mm
Circle Diameter: 14mm
Physical Size: ~234mm √ó 72mm (‡∏û‡∏≠‡∏î‡∏µ A4 ‡πÅ‡∏ô‡∏ß‡∏ô‡∏≠‡∏ô)
```

---

## üñ®Ô∏è Step 1: ‡∏û‡∏¥‡∏°‡∏û‡πå Calibration Pattern

### Option 1: ‡πÉ‡∏ä‡πâ Online Generator (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)

1. ‡πÑ‡∏õ‡∏ó‡∏µ‡πà https://calib.io/pages/camera-calibration-pattern-generator

2. ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å **"Asymmetric Circles Grid"**

3. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤:
   - **Rows**: 5
   - **Columns**: 13
   - **Spacing**: 18mm
   - **Circle Diameter**: 14mm
   - **Target Width**: A4 (210mm √ó 297mm)

4. ‡∏Å‡∏î **Download PDF**

5. ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏≠‡∏≠‡∏Å‡∏°‡∏≤:
   - ‡πÉ‡∏ä‡πâ‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏© A4 ‡∏Ç‡∏≤‡∏ß (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏´‡∏ô‡∏≤ 120g ‡∏´‡∏£‡∏∑‡∏≠‡∏°‡∏≤‡∏Å‡∏Å‡∏ß‡πà‡∏≤)
   - ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ printer: **Actual Size** (‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà "Fit to page")
   - ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏°‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î: ‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏ó‡πà‡∏≤‡∏Å‡∏±‡∏ö 18mm ‡∏à‡∏£‡∏¥‡∏á‡πÜ

### Option 2: ‡πÉ‡∏ä‡πâ OpenCV Script

```python
# generate_pattern.py
import cv2

pattern = cv2.aruco.GridBoard_create(
    markersX=13,
    markersY=5,
    markerLength=14,
    markerSeparation=4,
    dictionary=cv2.aruco.DICT_4X4_50
)
```

---

## üìã Step 2: ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏° Calibration Board

1. **‡∏ï‡∏¥‡∏î‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ö‡∏ô‡πÅ‡∏ú‡πà‡∏ô‡πÅ‡∏Ç‡πá‡∏á:**
   - ‡πÉ‡∏ä‡πâ foam board, acrylic, ‡∏´‡∏£‡∏∑‡∏≠ cardboard ‡πÅ‡∏Ç‡πá‡∏á‡πÜ
   - ‡∏ï‡∏¥‡∏î‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡∏ô ‡πÑ‡∏°‡πà‡∏¢‡πà‡∏ô ‡πÑ‡∏°‡πà‡πÇ‡∏Ñ‡πâ‡∏á
   - ‡∏Ç‡∏≠‡∏ö‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏©‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡∏¢‡∏∑‡πà‡∏ô‡∏≠‡∏≠‡∏Å‡∏°‡∏≤

2. **‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ö‡∏ô:**
   - ‡∏ß‡∏≤‡∏á‡∏ö‡∏ô flat surface
   - ‡∏ï‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÇ‡∏Å‡πà‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏¥‡∏î‡πÄ‡∏ö‡∏µ‡πâ‡∏¢‡∏ß

3. **‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î (optional):**
   - ‡πÄ‡∏Ñ‡∏•‡∏∑‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ laminate film (‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥)
   - ‡∏ä‡πà‡∏ß‡∏¢‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏õ‡∏∑‡πâ‡∏≠‡∏ô ‡πÅ‡∏•‡∏∞‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏°‡∏ä‡∏±‡∏î

---

## üì∏ Step 3: Capture Calibration Images

### Setup

```bash
# ‡∏£‡∏±‡∏ô‡∏™‡∏Ñ‡∏£‡∏¥‡∏õ‡∏ï‡πå‡πÄ‡∏Å‡πá‡∏ö‡∏†‡∏≤‡∏û
python3 capture_calibration.py
```

### Tips ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û Calibration ‡∏ó‡∏µ‡πà‡∏î‡∏µ

‚úÖ **DO:**
- ‡∏ñ‡πà‡∏≤‡∏¢‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏ô‡πâ‡∏≠‡∏¢ **20-30 ‡∏†‡∏≤‡∏û‡∏Ñ‡∏π‡πà**
- ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° **‡∏ó‡∏∏‡∏Å‡∏°‡∏∏‡∏°‡∏Ç‡∏≠‡∏á field of view**
- ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° **‡∏´‡∏•‡∏≤‡∏¢‡∏£‡∏∞‡∏¢‡∏∞‡∏´‡πà‡∏≤‡∏á** (40-80cm)
- ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏° **‡∏´‡∏•‡∏≤‡∏¢‡∏°‡∏∏‡∏°** (‡πÄ‡∏≠‡∏µ‡∏¢‡∏á, ‡∏´‡∏°‡∏∏‡∏ô, ‡∏ä‡∏¥‡∏î edge)
- ‡∏ñ‡∏∑‡∏≠ board ‡πÉ‡∏´‡πâ‡∏ô‡∏¥‡πà‡∏á‡∏ï‡∏≠‡∏ô‡∏Å‡∏î 'c'
- ‡πÅ‡∏™‡∏á‡∏™‡∏ß‡πà‡∏≤‡∏á‡∏û‡∏≠ ‡∏™‡∏°‡πà‡∏≥‡πÄ‡∏™‡∏°‡∏≠

‚ùå **DON'T:**
- ‡∏ñ‡πà‡∏≤‡∏¢‡πÅ‡∏ï‡πà‡∏°‡∏∏‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏ã‡πâ‡∏≥‡πÜ
- Board ‡πÄ‡∏ö‡∏•‡∏≠‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏´‡∏ß
- Pattern ‡πÇ‡∏î‡∏ô‡∏ö‡∏î‡∏ö‡∏±‡∏á‡∏ö‡∏≤‡∏á‡∏™‡πà‡∏ß‡∏ô
- ‡πÅ‡∏™‡∏á‡∏™‡∏∞‡∏ó‡πâ‡∏≠‡∏ô‡∏à‡πâ‡∏≤ (glare)
- ‡πÄ‡∏á‡∏≤‡∏ó‡∏±‡∏ö pattern

### ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î Pose ‡∏ó‡∏µ‡πà‡∏î‡∏µ

```
‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á 30 poses:

1-5:   ‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á, ‡∏£‡∏∞‡∏¢‡∏∞‡∏ï‡πà‡∏≤‡∏á‡∏Å‡∏±‡∏ô (40, 50, 60, 70, 80cm)
6-10:  ‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏ã‡πâ‡∏≤‡∏¢-‡∏Ç‡∏ß‡∏≤ (¬±15¬∞, ¬±30¬∞)
11-15: ‡πÄ‡∏≠‡∏µ‡∏¢‡∏á‡∏ö‡∏ô-‡∏•‡πà‡∏≤‡∏á (¬±15¬∞, ¬±30¬∞)
16-20: ‡∏´‡∏°‡∏∏‡∏ô (0¬∞, 45¬∞, 90¬∞, 135¬∞, 180¬∞)
21-25: ‡∏ä‡∏¥‡∏î‡∏Ç‡∏≠‡∏ö (‡∏ö‡∏ô, ‡∏•‡πà‡∏≤‡∏á, ‡∏ã‡πâ‡∏≤‡∏¢, ‡∏Ç‡∏ß‡∏≤, ‡∏°‡∏∏‡∏°)
26-30: ‡∏°‡∏∏‡∏°‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö (‡πÄ‡∏≠‡∏µ‡∏¢‡∏á + ‡∏´‡∏°‡∏∏‡∏ô)
```

### Controls

- **'c'** : Capture (‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠ detect pattern ‡∏ó‡∏±‡πâ‡∏á 2 ‡∏Å‡∏•‡πâ‡∏≠‡∏á)
- **'q'** : Quit

### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå

‡∏†‡∏≤‡∏û‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ó‡∏µ‡πà:
```
calib_images/
‚îú‚îÄ‚îÄ left/
‚îÇ   ‚îú‚îÄ‚îÄ img_000_20251023_150530.jpg
‚îÇ   ‚îú‚îÄ‚îÄ img_001_20251023_150535.jpg
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îî‚îÄ‚îÄ right/
    ‚îú‚îÄ‚îÄ img_000_20251023_150530.jpg
    ‚îú‚îÄ‚îÄ img_001_20251023_150535.jpg
    ‚îî‚îÄ‚îÄ ...
```

---

## üßÆ Step 4: Run Calibration

```bash
# ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì calibration parameters
python3 stereo_calibration.py
```

### ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ

1. **stereo_calib.yaml** - Calibration parameters
   - Camera matrices (intrinsic)
   - Distortion coefficients
   - Rotation & Translation (extrinsic)
   - Q matrix (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö depth calculation)

2. **rectification_maps.npz** - Rectification maps
   - ‡πÉ‡∏ä‡πâ rectify images ‡πÅ‡∏ö‡∏ö‡πÄ‡∏£‡πá‡∏ß (pre-computed)

### ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Ñ‡∏∏‡∏ì‡∏†‡∏≤‡∏û

**Stereo RMS Error:**
- < 0.5 pixels ‚Üí ‡∏î‡∏µ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏° ‚úì
- 0.5 - 1.0 ‚Üí ‡∏î‡∏µ ‚úì
- 1.0 - 2.0 ‚Üí ‡∏û‡∏≠‡πÉ‡∏ä‡πâ
- > 2.0 ‚Üí ‡∏Ñ‡∏ß‡∏£‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà

**Baseline:**
- IMX219-83: ~60mm
- ‡πÄ‡∏´‡∏°‡∏≤‡∏∞‡∏Å‡∏±‡∏ö working distance 40-100cm

---

## üß™ Step 5: Test Depth Map (Coming Soon)

```bash
# ‡∏ó‡∏î‡∏™‡∏≠‡∏ö depth accuracy
python3 test_depth_map.py
```

‡∏à‡∏∞‡πÅ‡∏™‡∏î‡∏á:
- Rectified stereo images
- Disparity map
- Depth map
- 3D point cloud

---

## üîß Troubleshooting

### Pattern ‡πÑ‡∏°‡πà detect

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:**
- ‡πÅ‡∏™‡∏á‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ ‚Üí ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÅ‡∏™‡∏á
- Pattern ‡πÄ‡∏ö‡∏•‡∏≠ ‚Üí Focus camera, ‡∏ñ‡∏∑‡∏≠‡πÉ‡∏´‡πâ‡∏ô‡∏¥‡πà‡∏á
- Board ‡∏ö‡∏¥‡∏î‡∏á‡∏≠ ‚Üí ‡πÉ‡∏ä‡πâ‡πÅ‡∏ú‡πà‡∏ô‡πÅ‡∏Ç‡πá‡∏á‡∏Å‡∏ß‡πà‡∏≤
- ‡∏£‡∏∞‡∏¢‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏´‡∏°‡∏≤‡∏∞ ‚Üí ‡∏•‡∏≠‡∏á‡∏£‡∏∞‡∏¢‡∏∞ 50-70cm

**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
```python
# ‡πÉ‡∏ô capture_calibration.py ‡πÅ‡∏Å‡πâ blob detector params:
params.minArea = 30      # ‡∏•‡∏î‡∏ñ‡πâ‡∏≤ circles ‡πÄ‡∏•‡πá‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
params.maxArea = 8000    # ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ñ‡πâ‡∏≤ circles ‡πÉ‡∏´‡∏ç‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ
params.minCircularity = 0.7  # ‡∏•‡∏î‡∏ñ‡πâ‡∏≤ detect ‡∏¢‡∏≤‡∏Å
```

### Calibration RMS Error ‡∏™‡∏π‡∏á (> 2.0)

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:**
- ‡∏†‡∏≤‡∏û‡πÑ‡∏°‡πà‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏ó‡∏±‡πà‡∏ß FOV
- ‡∏†‡∏≤‡∏û‡∏ã‡πâ‡∏≥‡∏Å‡∏±‡∏ô‡∏°‡∏≤‡∏Å‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ (‡∏°‡∏∏‡∏°‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô)
- Board ‡πÑ‡∏°‡πà flat
- ‡∏Ç‡∏ô‡∏≤‡∏î print ‡πÑ‡∏°‡πà‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö spec

**‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç:**
- ‡∏•‡∏ö‡∏†‡∏≤‡∏û‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏î‡∏µ‡∏≠‡∏≠‡∏Å
- ‡πÄ‡∏Å‡πá‡∏ö‡∏†‡∏≤‡∏û‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏à‡∏≤‡∏Å‡∏°‡∏∏‡∏°‡∏ó‡∏µ‡πà‡∏Ç‡∏≤‡∏î‡∏´‡∏≤‡∏¢‡πÑ‡∏õ
- ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡∏ô‡∏≤‡∏î pattern ‡∏î‡πâ‡∏ß‡∏¢‡πÑ‡∏°‡πâ‡∏ö‡∏£‡∏£‡∏ó‡∏±‡∏î
- ‡πÉ‡∏ä‡πâ board ‡∏ó‡∏µ‡πà‡πÅ‡∏Ç‡πá‡∏á‡∏Å‡∏ß‡πà‡∏≤

### Depth ‡πÑ‡∏°‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥

**‡∏™‡∏≤‡πÄ‡∏´‡∏ï‡∏∏:**
- Calibration ‡πÑ‡∏°‡πà‡∏î‡∏µ ‚Üí ‡∏ó‡∏≥‡πÉ‡∏´‡∏°‡πà
- Lighting ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á ‚Üí Recalibrate
- Camera moved ‚Üí Check mounting

---

## üìä Expected Results

‡∏´‡∏•‡∏±‡∏á calibration ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ:

‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì **depth (Z)** ‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡πÉ‡∏ô working space
‚úÖ ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì **3D position (X, Y, Z)** ‡∏Ç‡∏≠‡∏á‡∏û‡∏£‡∏¥‡∏Å
‚úÖ ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥ depth ¬± 5-10mm ‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏¢‡∏∞ 50-70cm
‚úÖ ‡πÉ‡∏ä‡πâ‡πÉ‡∏ô vision system ‡∏ï‡πà‡∏≠‡πÑ‡∏õ‡πÑ‡∏î‡πâ

---

## üìö References

- OpenCV Stereo Calibration: https://docs.opencv.org/4.x/d9/d0c/group__calib3d.html
- Camera Calibration Pattern Generator: https://calib.io/
- Asymmetric Circles vs Checkerboard: https://calib.io/blogs/knowledge-base/calibration-best-practices

---

## üéØ Next Steps

‡∏´‡∏•‡∏±‡∏á‡∏à‡∏≤‡∏Å calibration ‡πÄ‡∏™‡∏£‡πá‡∏à:

1. ‚úÖ Test depth accuracy (test_depth_map.py)
2. üìä ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô Week 1
3. üé® ‡πÄ‡∏£‡∏¥‡πà‡∏° Week 2: Dataset collection
4. ü§ñ Train YOLO model

---

**Good luck with calibration! üöÄ**
